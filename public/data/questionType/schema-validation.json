{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "IELTS Listening Question Type Schema Validation",
  "description": "Validation rules for all IELTS Listening question types",
  "definitions": {
    "meta": {
      "type": "object",
      "required": ["questionType", "variant", "section", "questionNumber"],
      "properties": {
        "questionType": {
          "type": "string",
          "enum": ["multiple_choice", "matching", "plan_map_diagram", "completion", "sentence_completion", "short_answer"]
        },
        "variant": {
          "type": "string",
          "enum": [
            "single_answer", "multiple_answers",
            "people_opinions", "locations_features", "events_info",
            "plan_labelling", "map_labelling", "diagram_labelling",
            "form_completion", "note_completion", "table_completion", "flowchart_completion", "summary_completion",
            "standard"
          ]
        },
        "section": {
          "type": "integer",
          "minimum": 1,
          "maximum": 4
        },
        "questionNumber": {
          "type": "integer",
          "minimum": 1,
          "maximum": 40
        },
        "difficulty": {
          "type": "string",
          "enum": ["easy", "medium", "hard"]
        },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+$"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        }
      }
    },
    "audioTimeRange": {
      "type": "object",
      "required": ["start", "end"],
      "properties": {
        "start": {
          "type": "string",
          "pattern": "^\\d{2}:\\d{2}$"
        },
        "end": {
          "type": "string",
          "pattern": "^\\d{2}:\\d{2}$"
        }
      },
      "additionalProperties": false
    },
    "media": {
      "type": "object",
      "properties": {
        "image": {
          "type": ["string", "null"],
          "pattern": "^/images/.*\\.(png|jpg|jpeg|gif)$"
        },
        "audio": {
          "type": "string",
          "pattern": "^/audio/.*\\.mp3$"
        }
      }
    },
    "uiHints": {
      "type": "object",
      "properties": {
        "displayType": {
          "type": "string",
          "enum": ["radio", "checkbox", "dropdown", "imageWithLabels", "mapWithMarkers", "form", "notes", "table", "flowchart", "summary", "sentences", "questions"]
        },
        "shuffleOptions": {
          "type": "boolean"
        },
        "dragAndDrop": {
          "type": "boolean"
        },
        "showLetterLabels": {
          "type": "boolean"
        },
        "showNumberLabels": {
          "type": "boolean"
        },
        "inlineInputs": {
          "type": "boolean"
        },
        "zoomEnabled": {
          "type": "boolean"
        }
      }
    },
    "scoring": {
      "type": "object",
      "required": ["points"],
      "properties": {
        "points": {
          "type": "integer",
          "minimum": 0,
          "maximum": 1
        },
        "partialCredit": {
          "type": "boolean"
        },
        "penaltyForWrong": {
          "type": "integer",
          "minimum": 0,
          "maximum": 1
        }
      }
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {
          "meta": {
            "properties": {
              "questionType": { "const": "multiple_choice" }
            }
          }
        }
      },
      "then": {
        "$ref": "#/definitions/multipleChoice"
      }
    },
    {
      "if": {
        "properties": {
          "meta": {
            "properties": {
              "questionType": { "const": "matching" }
            }
          }
        }
      },
      "then": {
        "$ref": "#/definitions/matching"
      }
    },
    {
      "if": {
        "properties": {
          "meta": {
            "properties": {
              "questionType": { "const": "plan_map_diagram" }
            }
          }
        }
      },
      "then": {
        "$ref": "#/definitions/planMapDiagram"
      }
    },
    {
      "if": {
        "properties": {
          "meta": {
            "properties": {
              "questionType": { "const": "completion" }
            }
          }
        }
      },
      "then": {
        "$ref": "#/definitions/completion"
      }
    },
    {
      "if": {
        "properties": {
          "meta": {
            "properties": {
              "questionType": { "const": "sentence_completion" }
            }
          }
        }
      },
      "then": {
        "$ref": "#/definitions/sentenceCompletion"
      }
    },
    {
      "if": {
        "properties": {
          "meta": {
            "properties": {
              "questionType": { "const": "short_answer" }
            }
          }
        }
      },
      "then": {
        "$ref": "#/definitions/shortAnswer"
      }
    }
  ],
  "definitions": {
    "multipleChoice": {
      "type": "object",
      "required": ["meta", "content", "answerKey", "scoring"],
      "properties": {
        "meta": { "$ref": "#/definitions/meta" },
        "content": {
          "type": "object",
          "required": ["questionText", "options", "answer"],
          "properties": {
            "questionText": { "type": "string", "minLength": 5 },
            "options": {
              "type": "array",
              "minItems": 3,
              "maxItems": 7,
              "items": {
                "type": "object",
                "required": ["id", "text"],
                "properties": {
                  "id": { "type": "string", "pattern": "^[A-G]$" },
                  "text": { "type": "string", "minLength": 1 }
                }
              }
            },
            "answer": {
              "type": "object",
              "properties": {
                "correctOption": { "type": "string", "pattern": "^[A-D]$" },
                "correctOptions": {
                  "type": "array",
                  "minItems": 2,
                  "maxItems": 3,
                  "items": { "type": "string", "pattern": "^[A-G]$" }
                },
                "explanation": { "type": "string" }
              }
            },
            "audioTimeRange": { "$ref": "#/definitions/audioTimeRange" },
            "media": { "$ref": "#/definitions/media" },
            "uiHints": { "$ref": "#/definitions/uiHints" },
            "validation": {
              "type": "object",
              "properties": {
                "minOptions": { "type": "integer", "minimum": 3, "maximum": 4 },
                "maxOptions": { "type": "integer", "minimum": 5, "maximum": 7 },
                "minCorrectRequired": { "type": "integer", "minimum": 1 },
                "required": { "type": "boolean" }
              }
            }
          }
        },
        "answerKey": { "type": ["string", "array"] },
        "scoring": { "$ref": "#/definitions/scoring" }
      }
    },
    "matching": {
      "type": "object",
      "required": ["meta", "content", "answerKey", "scoring"],
      "properties": {
        "meta": { "$ref": "#/definitions/meta" },
        "content": {
          "type": "object",
          "required": ["questionText", "questions", "options", "answer"],
          "properties": {
            "questionText": { "type": "string", "minLength": 5 },
            "questions": {
              "type": "array",
              "minItems": 3,
              "maxItems": 6,
              "items": {
                "type": "object",
                "required": ["id", "text"],
                "properties": {
                  "id": { "type": "integer" },
                  "text": { "type": "string", "minLength": 1 }
                }
              }
            },
            "options": {
              "type": "array",
              "minItems": 5,
              "maxItems": 7,
              "items": {
                "type": "object",
                "required": ["id", "text"],
                "properties": {
                  "id": { "type": "string", "pattern": "^[A-G]$" },
                  "text": { "type": "string", "minLength": 1 }
                }
              }
            },
            "answer": {
              "type": "object",
              "required": ["matches", "explanation"],
              "properties": {
                "matches": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": ["questionId", "optionId"],
                    "properties": {
                      "questionId": { "type": "integer" },
                      "optionId": { "type": "string", "pattern": "^[A-G]$" }
                    }
                  }
                },
                "explanation": { "type": "string" }
              }
            },
            "instructions": { "type": "string" },
            "audioTimeRange": { "$ref": "#/definitions/audioTimeRange" },
            "media": { "$ref": "#/definitions/media" },
            "uiHints": { "$ref": "#/definitions/uiHints" },
            "validation": {
              "type": "object",
              "properties": {
                "eachOptionUsedOnce": { "type": "boolean" },
                "required": { "type": "boolean" }
              }
            }
          }
        },
        "answerKey": { "type": "object" },
        "scoring": { "$ref": "#/definitions/scoring" }
      }
    },
    "planMapDiagram": {
      "type": "object",
      "required": ["meta", "content", "answerKey", "scoring"],
      "properties": {
        "meta": { "$ref": "#/definitions/meta" },
        "content": {
          "type": "object",
          "required": ["questionText", "image", "answer"],
          "properties": {
            "questionText": { "type": "string", "minLength": 5 },
            "image": {
              "type": "object",
              "required": ["url", "hotspots"],
              "properties": {
                "url": { "type": "string", "pattern": "^/images/.*\\.png$" },
                "altText": { "type": "string" },
                "width": { "type": "integer", "minimum": 400 },
                "height": { "type": "integer", "minimum": 300 },
                "hotspots": {
                  "type": "array",
                  "minItems": 3,
                  "maxItems": 6,
                  "items": {
                    "type": "object",
                    "required": ["id", "x", "y", "label"],
                    "properties": {
                      "id": { "type": "integer" },
                      "x": { "type": "integer", "minimum": 0 },
                      "y": { "type": "integer", "minimum": 0 },
                      "label": { "type": "string" },
                      "position": { "type": "string", "enum": ["left", "right", "top", "bottom"] },
                      "marker": { "type": "string", "enum": ["pin", "circle", "square"] }
                    }
                  }
                }
              }
            },
            "answer": {
              "type": "object",
              "additionalProperties": { "type": "string" }
            },
            "explanation": { "type": "string" },
            "instructions": { "type": "string" },
            "audioTimeRange": { "$ref": "#/definitions/audioTimeRange" },
            "media": { "$ref": "#/definitions/media" },
            "uiHints": { "$ref": "#/definitions/uiHints" },
            "validation": {
              "type": "object",
              "properties": {
                "minQuestions": { "type": "integer", "minimum": 3, "maximum": 6 },
                "maxQuestions": { "type": "integer", "minimum": 3, "maximum": 6 },
                "required": { "type": "boolean" }
              }
            }
          }
        },
        "answerKey": { "type": "object" },
        "scoring": { "$ref": "#/definitions/scoring" }
      }
    },
    "completion": {
      "type": "object",
      "required": ["meta", "content", "answerKey", "scoring"],
      "properties": {
        "meta": { "$ref": "#/definitions/meta" },
        "content": {
          "type": "object",
          "required": ["questionText", "wordLimit", "answer"],
          "properties": {
            "questionText": { "type": "string", "minLength": 5 },
            "instructions": { "type": "string" },
            "wordLimit": {
              "type": "string",
              "enum": [
                "ONE WORD ONLY",
                "NO MORE THAN TWO WORDS",
                "NO MORE THAN TWO WORDS AND/OR A NUMBER",
                "NO MORE THAN THREE WORDS"
              ]
            },
            "formData": {
              "type": "object",
              "properties": {
                "formTitle": { "type": "string" },
                "fields": {
                  "type": "array",
                  "minItems": 5,
                  "maxItems": 12,
                  "items": {
                    "type": "object",
                    "required": ["id", "label", "answer"],
                    "properties": {
                      "id": { "type": "integer" },
                      "label": { "type": "string" },
                      "placeholder": { "type": "string" },
                      "inputType": {
                        "type": "string",
                        "enum": ["text", "email", "tel", "number", "date", "select"]
                      },
                      "required": { "type": "boolean" },
                      "answer": { "type": "string" },
                      "audioTimeRange": { "$ref": "#/definitions/audioTimeRange" }
                    }
                  }
                }
              }
            },
            "notes": {
              "type": "object",
              "properties": {
                "title": { "type": "string" },
                "sections": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "heading": { "type": "string" },
                      "bulletPoints": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "required": ["id", "text", "answer"],
                          "properties": {
                            "id": { "type": "integer" },
                            "text": { "type": "string" },
                            "answer": { "type": "string" }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "table": {
              "type": "object",
              "properties": {
                "title": { "type": "string" },
                "headers": { "type": "array", "minItems": 2, "maxItems": 5 },
                "rows": {
                  "type": "array",
                  "minItems": 3,
                  "maxItems": 8,
                  "items": {
                    "type": "object",
                    "required": ["id", "cells"],
                    "properties": {
                      "id": { "type": "integer" },
                      "cells": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "value": { "type": "string" },
                            "isEditable": { "type": "boolean" },
                            "answer": { "type": "string" },
                            "audioTimeRange": { "$ref": "#/definitions/audioTimeRange" }
                          }
                        }
                      }
                    }
                  }
                }
              }
            },
            "flowchart": {
              "type": "object",
              "properties": {
                "title": { "type": "string" },
                "startNode": { "type": "object" },
                "nodes": {
                  "type": "array",
                  "minItems": 3,
                  "maxItems": 8,
                  "items": {
                    "type": "object",
                    "required": ["id", "text", "answer"],
                    "properties": {
                      "id": { "type": "integer" },
                      "text": { "type": "string" },
                      "answer": { "type": "string" },
                      "position": {
                        "type": "object",
                        "properties": {
                          "x": { "type": "integer" },
                          "y": { "type": "integer" }
                        }
                      },
                      "audioTimeRange": { "$ref": "#/definitions/audioTimeRange" }
                    }
                  }
                },
                "endNode": { "type": "object" },
                "connections": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "from": { "type": ["string", "integer"] },
                      "to": { "type": ["string", "integer"] }
                    }
                  }
                }
              }
            },
            "summary": {
              "type": "object",
              "properties": {
                "text": { "type": "string", "minLength": 100 },
                "blanks": {
                  "type": "array",
                  "minItems": 3,
                  "maxItems": 8,
                  "items": {
                    "type": "object",
                    "required": ["id", "position", "answer"],
                    "properties": {
                      "id": { "type": "integer" },
                      "position": { "type": "integer", "minimum": 0 },
                      "answer": { "type": "string" },
                      "audioTimeRange": { "$ref": "#/definitions/audioTimeRange" }
                    }
                  }
                },
                "options": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": ["id", "text"],
                    "properties": {
                      "id": { "type": "string", "pattern": "^[A-J]$" },
                      "text": { "type": "string" }
                    }
                  }
                }
              }
            },
            "answer": {
              "type": "object",
              "additionalProperties": { "type": "string" }
            },
            "explanation": { "type": "string" },
            "audioTimeRange": { "$ref": "#/definitions/audioTimeRange" },
            "media": { "$ref": "#/definitions/media" },
            "uiHints": { "$ref": "#/definitions/uiHints" },
            "validation": {
              "type": "object",
              "properties": {
                "minQuestions": { "type": "integer", "minimum": 3, "maximum": 10 },
                "maxQuestions": { "type": "integer", "minimum": 3, "maximum": 10 }
              }
            }
          }
        },
        "answerKey": { "type": "object" },
        "scoring": { "$ref": "#/definitions/scoring" }
      }
    },
    "sentenceCompletion": {
      "type": "object",
      "required": ["meta", "content", "answerKey", "scoring"],
      "properties": {
        "meta": { "$ref": "#/definitions/meta" },
        "content": {
          "type": "object",
          "required": ["questionText", "sentences", "wordLimit", "answer"],
          "properties": {
            "questionText": { "type": "string", "minLength": 5 },
            "instructions": { "type": "string" },
            "sentences": {
              "type": "array",
              "minItems": 3,
              "maxItems": 8,
              "items": {
                "type": "object",
                "required": ["id", "text", "answer"],
                "properties": {
                  "id": { "type": "integer" },
                  "text": { "type": "string", "minLength": 10 },
                  "blankPosition": { "type": "string", "enum": ["start", "middle", "end"] },
                  "fullSentence": { "type": "string" },
                  "answer": { "type": "string" },
                  "audioTimeRange": { "$ref": "#/definitions/audioTimeRange" }
                }
              }
            },
            "wordLimit": {
              "type": "string",
              "enum": [
                "ONE WORD ONLY",
                "NO MORE THAN TWO WORDS",
                "NO MORE THAN THREE WORDS"
              ]
            },
            "answer": {
              "type": "object",
              "additionalProperties": { "type": "string" }
            },
            "explanation": { "type": "string" },
            "audioTimeRange": { "$ref": "#/definitions/audioTimeRange" },
            "media": { "$ref": "#/definitions/media" },
            "uiHints": { "$ref": "#/definitions/uiHints" },
            "validation": {
              "type": "object",
              "properties": {
                "minQuestions": { "type": "integer", "minimum": 3, "maximum": 8 },
                "maxQuestions": { "type": "integer", "minimum": 3, "maximum": 8 }
              }
            }
          }
        },
        "answerKey": { "type": "object" },
        "scoring": { "$ref": "#/definitions/scoring" }
      }
    },
    "shortAnswer": {
      "type": "object",
      "required": ["meta", "content", "answerKey", "scoring"],
      "properties": {
        "meta": { "$ref": "#/definitions/meta" },
        "content": {
          "type": "object",
          "required": ["questionText", "questions", "wordLimit", "answer"],
          "properties": {
            "questionText": { "type": "string", "minLength": 5 },
            "instructions": { "type": "string" },
            "questions": {
              "type": "array",
              "minItems": 3,
              "maxItems": 8,
              "items": {
                "type": "object",
                "required": ["id", "text", "answer", "answerType"],
                "properties": {
                  "id": { "type": "integer" },
                  "text": { "type": "string", "minLength": 5 },
                  "answer": { "type": "string" },
                  "alternativeAnswers": {
                    "type": "array",
                    "items": { "type": "string" }
                  },
                  "answerType": { "type": "string", "enum": ["text", "number"] },
                  "audioTimeRange": { "$ref": "#/definitions/audioTimeRange" }
                }
              }
            },
            "wordLimit": {
              "type": "string",
              "enum": [
                "ONE WORD ONLY",
                "NO MORE THAN TWO WORDS",
                "NO MORE THAN TWO WORDS AND/OR A NUMBER"
              ]
            },
            "answer": {
              "type": "object",
              "additionalProperties": { "type": "string" }
            },
            "explanation": { "type": "string" },
            "audioTimeRange": { "$ref": "#/definitions/audioTimeRange" },
            "media": { "$ref": "#/definitions/media" },
            "uiHints": { "$ref": "#/definitions/uiHints" },
            "validation": {
              "type": "object",
              "properties": {
                "minQuestions": { "type": "integer", "minimum": 3, "maximum": 8 },
                "maxQuestions": { "type": "integer", "minimum": 3, "maximum": 8 }
              }
            }
          }
        },
        "answerKey": { "type": "object" },
        "scoring": { "$ref": "#/definitions/scoring" }
      }
    }
  }
}
